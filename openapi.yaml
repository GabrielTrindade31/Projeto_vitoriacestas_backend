openapi: 3.0.3
info:
  title: API Estoque Vitória Cestas
  version: 1.2.0
  description: Endpoints para gestão de itens, fornecedores, autenticação e demais cadastros previstos no banco de dados.
servers:
  - url: http://{host}
    variables:
      host:
        default: localhost:3000
  - url: https://projeto-vitoriacestas-backend.vercel.app
paths:
  /api/auth/login:
    post:
      summary: Login com perfis
      tags: [Autenticação]
      description: Autentica usuário (Admin, Gestor ou Operador) e retorna tokens de acesso e refresh.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
            examples:
              admin:
                summary: Administrador padrão (memória)
                value:
                  email: admin@vitoriacestas.com
                  password: admin123
              gestor:
                summary: Gestor padrão (memória)
                value:
                  email: gestor@vitoriacestas.com
                  password: gestor123
              operador:
                summary: Operador padrão (memória)
                value:
                  email: operador@vitoriacestas.com
                  password: operador123
      responses:
        '200':
          description: Tokens gerados com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                      role:
                        type: string
                      name:
                        type: string
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  expiresIn:
                    type: string
        '400':
          description: Requisição inválida
        '401':
          description: Credenciais inválidas
  /api/auth/refresh:
    post:
      summary: Renovação de tokens
      tags: [Autenticação]
      description: Gera um novo par de tokens a partir de um refresh token válido.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Tokens renovados
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  expiresIn:
                    type: string
        '400':
          description: Requisição inválida
        '401':
          description: Refresh token inválido
  /api/items:
    get:
      summary: Lista itens cadastrados
      tags: [Itens]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Itens retornados com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Item'
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra novo item
      tags: [Itens]
      security:
        - bearerAuth: []
      description: Disponível para perfis Admin e Gestor.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemInput'
      responses:
        '201':
          description: Item criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
        '409':
          description: Código duplicado
  /api/suppliers:
    get:
      summary: Lista fornecedores cadastrados
      tags: [Fornecedores]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Fornecedores retornados com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  suppliers:
                    type: array
                    items:
                      $ref: '#/components/schemas/Fornecedor'
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra fornecedor
      tags: [Fornecedores]
      security:
        - bearerAuth: []
      description: Disponível apenas para perfil Admin.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FornecedorInput'
      responses:
        '201':
          description: Fornecedor criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FornecedorResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
        '409':
          description: CNPJ duplicado
  /api/addresses:
    get:
      summary: Lista endereços cadastrados
      tags: [Endereços]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Endereços retornados
          content:
            application/json:
              schema:
                type: object
                properties:
                  addresses:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/EnderecoInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra endereço
      tags: [Endereços]
      security:
        - bearerAuth: []
      description: Cria um novo endereço para ser associado a clientes ou fornecedores.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnderecoInput'
      responses:
        '201':
          description: Endereço criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnderecoResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
  /api/customers:
    get:
      summary: Lista clientes cadastrados
      tags: [Clientes]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Clientes retornados
          content:
            application/json:
              schema:
                type: object
                properties:
                  customers:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/ClienteInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra cliente
      tags: [Clientes]
      security:
        - bearerAuth: []
      description: Cria um cliente com CPF ou CNPJ, data de nascimento e endereço obrigatório.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClienteInput'
      responses:
        '201':
          description: Cliente criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClienteResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
        '409':
          description: CPF ou CNPJ duplicado
  /api/raw-materials:
    get:
      summary: Lista matérias-primas
      tags: [Matérias-primas]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Materiais retornados
          content:
            application/json:
              schema:
                type: object
                properties:
                  materials:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/MateriaPrimaInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra matéria-prima
      tags: [Matérias-primas]
      security:
        - bearerAuth: []
      description: Registra uma matéria-prima com informações de custo, validade e características.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MateriaPrimaInput'
      responses:
        '201':
          description: Matéria-prima criada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MateriaPrimaResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
  /api/manufacturing:
    get:
      summary: Lista relações de manufatura
      tags: [Manufatura]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Relações retornadas
          content:
            application/json:
              schema:
                type: object
                properties:
                  manufacturing:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/ManufaturaInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Registra composição de manufatura
      tags: [Manufatura]
      security:
        - bearerAuth: []
      description: Define a relação entre produto e matéria-prima utilizada, com a quantidade consumida.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManufaturaInput'
      responses:
        '201':
          description: Relação de manufatura criada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManufaturaResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
  /api/material-deliveries:
    get:
      summary: Lista entradas de matéria-prima
      tags: [Entregas de Material]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Entradas retornadas
          content:
            application/json:
              schema:
                type: object
                properties:
                  deliveries:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/EntregaMaterialInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra entrada de matéria-prima
      tags: [Entregas de Material]
      security:
        - bearerAuth: []
      description: Registra a entrega de material por um fornecedor, incluindo data, quantidade e custo.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EntregaMaterialInput'
      responses:
        '201':
          description: Entrada de material registrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntregaMaterialResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
  /api/orders:
    get:
      summary: Lista pedidos
      tags: [Pedidos]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Pedidos retornados
          content:
            application/json:
              schema:
                type: object
                properties:
                  orders:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/PedidoInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra pedido
      tags: [Pedidos]
      security:
        - bearerAuth: []
      description: Cria um pedido para um cliente, com dados do presenteado quando aplicável.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PedidoInput'
      responses:
        '201':
          description: Pedido criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PedidoResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
  /api/product-shipments:
    get:
      summary: Lista envios de produtos
      tags: [Envios]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Envios retornados
          content:
            application/json:
              schema:
                type: object
                properties:
                  shipments:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/EnvioProdutoInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Registra envio de produto
      tags: [Envios]
      security:
        - bearerAuth: []
      description: Liga um pedido a um produto enviado, com data e preço aplicados.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnvioProdutoInput'
      responses:
        '201':
          description: Envio registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvioProdutoResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
  /api/feedbacks:
    get:
      summary: Lista feedbacks
      tags: [Feedbacks]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Feedbacks retornados
          content:
            application/json:
              schema:
                type: object
                properties:
                  feedbacks:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/FeedbackInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra feedback
      tags: [Feedbacks]
      security:
        - bearerAuth: []
      description: Registra a avaliação de um cliente sobre um pedido ou serviço prestado.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackInput'
      responses:
        '201':
          description: Feedback registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeedbackResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
  /api/phones:
    get:
      summary: Lista telefones de clientes
      tags: [Telefones]
      security:
        - bearerAuth: []
      description: Disponível para Admin, Gestor e Operador.
      responses:
        '200':
          description: Telefones retornados
          content:
            application/json:
              schema:
                type: object
                properties:
                  phones:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/TelefoneInput'
                        - type: object
                          properties:
                            id:
                              type: integer
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
    post:
      summary: Cadastra telefone de cliente
      tags: [Telefones]
      security:
        - bearerAuth: []
      description: Associa um telefone adicional a um cliente existente.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelefoneInput'
      responses:
        '201':
          description: Telefone cadastrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelefoneResponse'
        '400':
          description: Falha de validação
        '401':
          description: Token ausente ou inválido
        '403':
          description: Permissão insuficiente
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ItemInput:
      type: object
      required: [codigo, nome, quantidade, preco]
      properties:
        codigo:
          type: string
        nome:
          type: string
        descricao:
          type: string
        categoria:
          type: string
        quantidade:
          type: integer
          nullable: true
          minimum: 0
          default: 0
        preco:
          type: number
          format: float
          minimum: 0
          nullable: true
          default: 0
        fornecedorId:
          type: integer
          nullable: true
    ItemResponse:
      type: object
      properties:
        message:
          type: string
        item:
          allOf:
            - $ref: '#/components/schemas/ItemInput'
            - type: object
              properties:
                id:
                  type: integer
    Item:
      allOf:
        - $ref: '#/components/schemas/ItemInput'
        - type: object
          properties:
            id:
              type: integer
    EnderecoInput:
      type: object
      required: [rua, cep, numero]
      properties:
        rua:
          type: string
        cep:
          type: string
        numero:
          type: string
    EnderecoResponse:
      type: object
      properties:
        message:
          type: string
        address:
          allOf:
            - $ref: '#/components/schemas/EnderecoInput'
            - type: object
              properties:
                id:
                  type: integer
    ClienteInput:
      type: object
      required: [nome, dataNascimento, enderecoId]
      properties:
        cnpj:
          type: string
        cpf:
          type: string
        nome:
          type: string
        email:
          type: string
          format: email
        dataNascimento:
          type: string
          format: date
        enderecoId:
          type: integer
          nullable: false
    ClienteResponse:
      type: object
      properties:
        message:
          type: string
        customer:
          allOf:
            - $ref: '#/components/schemas/ClienteInput'
            - type: object
              properties:
                id:
                  type: integer
    MateriaPrimaInput:
      type: object
      required: [nome]
      properties:
        nome:
          type: string
        tipo:
          type: string
        custo:
          type: number
          format: float
          nullable: true
          default: 0
        dataValidade:
          type: string
          format: date
        descricao:
          type: string
        tamanho:
          type: string
        material:
          type: string
        acessorio:
          type: string
    MateriaPrimaResponse:
      type: object
      properties:
        message:
          type: string
        material:
          allOf:
            - $ref: '#/components/schemas/MateriaPrimaInput'
            - type: object
              properties:
                id:
                  type: integer
    ManufaturaInput:
      type: object
      required: [produtoId, materialId, quantidadeMaterial]
      properties:
        produtoId:
          type: integer
        materialId:
          type: integer
        quantidadeMaterial:
          type: integer
          default: 0
          minimum: 0
    ManufaturaResponse:
      type: object
      properties:
        message:
          type: string
        manufacturing:
          allOf:
            - $ref: '#/components/schemas/ManufaturaInput'
            - type: object
              properties:
                id:
                  type: integer
    EntregaMaterialInput:
      type: object
      required: [materialId, quantidade, dataEntrada]
      properties:
        materialId:
          type: integer
        fornecedorId:
          type: integer
          nullable: true
          default: null
        quantidade:
          type: integer
          default: 0
          minimum: 0
        dataEntrada:
          type: string
          format: date
        custo:
          type: number
          format: float
          nullable: true
          default: 0
    EntregaMaterialResponse:
      type: object
      properties:
        message:
          type: string
        delivery:
          allOf:
            - $ref: '#/components/schemas/EntregaMaterialInput'
            - type: object
              properties:
                id:
                  type: integer
    PedidoInput:
      type: object
      required: [clienteId, preco, dataPedido]
      properties:
        clienteId:
          type: integer
          nullable: true
        endereco:
          type: string
        preco:
          type: number
          format: float
          default: 0
          minimum: 0
        dataPedido:
          type: string
          format: date
        cpfPresentado:
          type: string
        nomePresentado:
          type: string
        emailPresentado:
          type: string
          format: email
        enderecoPresentado:
          type: string
    PedidoResponse:
      type: object
      properties:
        message:
          type: string
        order:
          allOf:
            - $ref: '#/components/schemas/PedidoInput'
            - type: object
              properties:
                id:
                  type: integer
    EnvioProdutoInput:
      type: object
      required: [pedidoId, produtoId, quantidade]
      properties:
        pedidoId:
          type: integer
          nullable: true
        produtoId:
          type: integer
          nullable: true
        quantidade:
          type: integer
          default: 0
          minimum: 0
        dataEnvio:
          type: string
          format: date
        preco:
          type: number
          format: float
          default: 0
          minimum: 0
    EnvioProdutoResponse:
      type: object
      properties:
        message:
          type: string
        shipment:
          allOf:
            - $ref: '#/components/schemas/EnvioProdutoInput'
            - type: object
              properties:
                id:
                  type: integer
    FeedbackInput:
      type: object
      required: [clienteId, nota]
      properties:
        clienteId:
          type: integer
          nullable: true
        data:
          type: string
          format: date
        nota:
          type: integer
          default: 0
        contato:
          type: string
        observacao:
          type: string
    FeedbackResponse:
      type: object
      properties:
        message:
          type: string
        feedback:
          allOf:
            - $ref: '#/components/schemas/FeedbackInput'
            - type: object
              properties:
                id:
                  type: integer
    TelefoneInput:
      type: object
      required: [clienteId, numero]
      properties:
        clienteId:
          type: integer
        ddd:
          type: string
        numero:
          type: string
    TelefoneResponse:
      type: object
      properties:
        message:
          type: string
        phone:
          allOf:
            - $ref: '#/components/schemas/TelefoneInput'
            - type: object
              properties:
                id:
                  type: integer
    FornecedorInput:
      type: object
      required: [cnpj, razaoSocial, contato, email, telefone]
      properties:
        cnpj:
          type: string
        razaoSocial:
          type: string
        contato:
          type: string
        email:
          type: string
          format: email
        telefone:
          type: string
        enderecoId:
          type: integer
          nullable: true
    FornecedorResponse:
      type: object
      properties:
        message:
          type: string
        supplier:
          allOf:
            - $ref: '#/components/schemas/FornecedorInput'
            - type: object
              properties:
                id:
                  type: integer
    Fornecedor:
      allOf:
        - $ref: '#/components/schemas/FornecedorInput'
        - type: object
          properties:
            id:
              type: integer
